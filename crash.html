<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Crash — Predictor</title>
  <meta name="theme-color" content="#0b0f1c" />
  <style>
    :root{
      --bg:#0b0f1c; --panel:#0f1732; --text:#e6eaf5; --muted:#9fb0c9;
      --p1:#7c3aed; --p2:#06b6d4; --good:#10b981; --warn:#f59e0b; --bad:#ef4444;
      --ring: conic-gradient(from var(--a,0deg), #7c3aed, #06b6d4, #7c3aed);
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; background:linear-gradient(180deg, #0b0f1c 0%, #0a1226 100%);
      color:var(--text); font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Inter,Roboto,Arial,sans-serif;
    }
    .wrap{ min-height:100svh; max-width:520px; margin:0 auto; padding:16px 12px 24px; display:flex; flex-direction:column; gap:12px }
    .top{ display:flex; align-items:center; gap:10px }
    .back{
      width:40px; height:40px; border-radius:12px; border:1px solid rgba(255,255,255,.08);
      background:linear-gradient(145deg,#141f3f,#0f1732); color:#cbd5e1; display:grid; place-items:center; cursor:pointer;
    }
    .title{ font-weight:900; letter-spacing:.4px; font-size:18px }

    .panel{
      background:linear-gradient(180deg, rgba(16,23,49,.92), rgba(11,16,32,.9));
      border:1px solid rgba(255,255,255,.06); border-radius:16px; padding:14px; position:relative; overflow:hidden;
    }

    .ring{
      width:220px; height:220px; border-radius:50%; margin:6px auto 8px; position:relative; display:grid; place-items:center;
      background:var(--ring); animation:spin 6s linear infinite; --a:0deg;
    }
    .ring::before{
      content:""; position:absolute; inset:8px; background:#0b0f1c; border-radius:50%;
      box-shadow:inset 0 0 30px rgba(124,58,237,.15), inset 0 0 60px rgba(6,182,212,.1);
    }
    @keyframes spin{ 0%{--a:0deg} 100%{--a:360deg} }

    /* décor animé derrière la valeur */
    .mesh{
      position:absolute; inset:12px; border-radius:50%; overflow:hidden; z-index:0;
      background:
        radial-gradient(60% 60% at 70% 30%, rgba(124,58,237,.18), transparent 60%),
        repeating-linear-gradient(45deg, rgba(255,255,255,.06) 0 1px, transparent 1px 12px),
        repeating-linear-gradient(-45deg, rgba(255,255,255,.04) 0 1px, transparent 1px 12px);
      background-size:auto, 26px 26px, 26px 26px;
      animation:meshMove 14s linear infinite; filter:saturate(1.1);
    }
    @keyframes meshMove{ 0%{background-position:0 0,0 0,0 0} 100%{background-position:0 0,520px 0,0 520px} }
    .swirl{
      position:absolute; inset:18px; border-radius:50%; z-index:0; opacity:.35;
      background:
        repeating-conic-gradient(from 0deg, rgba(124,58,237,.08) 0deg 10deg, transparent 10deg 24deg),
        radial-gradient(60% 60% at 30% 70%, rgba(6,182,212,.10), transparent 60%);
      animation:swirl 8s linear infinite; mix-blend-mode:screen;
    }
    @keyframes swirl{ to{ transform:rotate(360deg) } }
    body.aviator .swirl{ opacity:.6; animation-duration:5.5s }

    .value{ position:relative; z-index:2; font-weight:900; font-size:40px; color:#c7d2fe; text-shadow:0 0 14px rgba(124,58,237,.35) }
    .status{ text-align:center; color:var(--muted); font-size:13px; margin-top:2px }

    .info{ display:grid; grid-template-columns:repeat(3, 1fr); gap:8px; margin-top:10px }
    .info .col{ background:#0e1530; border:1px solid rgba(255,255,255,.06); border-radius:12px; padding:8px 10px; text-align:center }
    .k{ font-size:11px; color:#9fb0c9; letter-spacing:.4px }
    .v{ font-size:16px; font-weight:800; margin-top:2px }
    .signal-actif{ color:var(--good) }
    .signal-inactif{ color:#eab308 }

    .row{ display:flex; justify-content:space-between; align-items:center; gap:8px; margin-top:10px }
    .btn{
      flex:1; height:50px; border:none; border-radius:14px; font-weight:900; letter-spacing:.2px; cursor:pointer;
      background:linear-gradient(135deg, #7c3aed, #06b6d4); color:#0b0f1c; box-shadow:0 14px 30px rgba(124,58,237,.35);
      transition:transform .15s ease;
    }
    .btn:active{ transform:translateY(1px) scale(.98) }
    .meta{ min-width:135px; text-align:right; color:#9fb0c9; font-size:12px }
    .meta b{ color:#e6eaf5 }

    .hint{ text-align:center; color:#8aa0c7; font-size:12px; margin-top:8px }
    footer{ margin-top:auto; color:#8ea3c5; font-size:12px; text-align:center; opacity:.7 }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="top">
      <button class="back" onclick="location.href='index.html'">←</button>
      <div class="title" id="gameTitle">Crash</div>
    </div>

    <section class="panel">
      <div class="ring" id="ring">
        <div class="mesh"></div>
        <div class="swirl"></div>
        <div class="value" id="val">0.00×</div>
      </div>
      <div class="status" id="status">Prêt</div>

      <div class="info">
        <div class="col"><div class="k">HEURE</div><div class="v" id="heure">--:--</div></div>
        <div class="col"><div class="k">CHANCE</div><div class="v" id="chance">--%</div></div>
        <div class="col"><div class="k">Signal</div><div class="v" id="signal">—</div></div>
      </div>

      <div class="row">
        <button class="btn" id="run">Lancer le signal</button>
        <div class="meta"><span id="metaLabel">Début dans</span> <b id="count">--:--</b></div>
      </div>

      <div class="hint">Le signal devient Actif à l’heure indiquée, puis repasse Inactif. Pause obligatoire avant une nouvelle prédiction.</div>
    </section>

    <footer>© 2025 Predictor — Site public non affilié. +18.</footer>
  </div>

  <script>
    // Config cooldown après la fenêtre active (en secondes)
    const COOL_MIN = 30, COOL_MAX = 60; // ajustable

    const qs = new URLSearchParams(location.search);
    const game = qs.get('game') || 'Crash';
    document.getElementById('gameTitle').textContent = game + ' — Crash';
    if(game.toLowerCase() === 'aviator'){ document.body.classList.add('aviator'); }

    const ring = document.getElementById('ring');
    const val = document.getElementById('val');
    const statusEl = document.getElementById('status');
    const runBtn = document.getElementById('run');
    const heureEl = document.getElementById('heure');
    const chanceEl = document.getElementById('chance');
    const signalEl = document.getElementById('signal');
    const countEl = document.getElementById('count');
    const metaLabel = document.getElementById('metaLabel');

    const ACTIVE_WINDOW_MS = 60_000;
    let busy = false;
    let scheduledAt = null;
    let lockUntil = 0;
    let timer = null;

    function pad(n){ return String(n).padStart(2,'0'); }
    function format(sec){ sec = Math.max(0, sec|0); return pad(Math.floor(sec/60)) + ':' + pad(sec%60); }

    function runCountdown(){
      clearInterval(timer);
      timer = setInterval(()=>{
        const now = Date.now();
        if(!scheduledAt){
          countEl.textContent = '--:--';
          metaLabel.textContent = 'Début dans';
          return;
        }
        const msLeft = scheduledAt.getTime() - now;
        if(msLeft > 0){
          metaLabel.textContent = 'Début dans';
          countEl.textContent = format(Math.ceil(msLeft/1000));
          signalEl.textContent = 'Inactif!'; signalEl.className = 'v signal-inactif';
          runBtn.disabled = true;
        }else if(msLeft > -ACTIVE_WINDOW_MS){
          metaLabel.textContent = 'Signal';
          countEl.textContent = 'Actif';
          signalEl.textContent = 'Actif!'; signalEl.className = 'v signal-actif';
          runBtn.disabled = true;
        }else{
          // Fenêtre terminée: pause
          const pauseLeft = Math.ceil((lockUntil - now)/1000);
          if(now < lockUntil){
            metaLabel.textContent = 'Pause';
            countEl.textContent = format(pauseLeft);
            signalEl.textContent = 'Inactif!'; signalEl.className = 'v signal-inactif';
            runBtn.disabled = true;
          }else{
            metaLabel.textContent = 'Prêt';
            countEl.textContent = '--:--';
            runBtn.disabled = false;
          }
        }
      }, 1000);
    }

    runBtn.addEventListener('click', async ()=>{
      if(busy || runBtn.disabled) return; busy = true; runBtn.disabled = true;
      statusEl.textContent = 'Scan en cours...'; val.textContent = '---';
      ring.style.animationDuration = '2.6s';

      await new Promise(r => setTimeout(r, 1200 + Math.random()*1500));

      const result = (Math.random() * (7.8 - 1.3) + 1.3).toFixed(2);
      val.textContent = result + '×';

      const resNum = parseFloat(result);
      if(resNum >= 6) val.style.color = '#f59e0b';
      else if(resNum >= 3) val.style.color = '#10b981';
      else val.style.color = '#a5b4fc';

      statusEl.textContent = 'Résultat prêt';
      ring.style.animationDuration = '6s';

      const addMin = 1 + Math.floor(Math.random()*3); // HEURE = +1..3 min
      scheduledAt = new Date(Date.now() + addMin*60*1000);
      heureEl.textContent = pad(scheduledAt.getHours()) + ':' + pad(scheduledAt.getMinutes());

      const chance = Math.max(85, Math.min(99, Math.round(85 + ((resNum - 1.3)/(7.8-1.3))*14)));
      chanceEl.textContent = chance + '%';

      // verrou: jusqu’à fin de la fenêtre active + cooldown
      const extra = (COOL_MIN + Math.floor(Math.random() * (COOL_MAX - COOL_MIN + 1))) * 1000;
      lockUntil = scheduledAt.getTime() + ACTIVE_WINDOW_MS + extra;

      runCountdown();
      setTimeout(()=>{ busy = false; }, 1200);
    });

    runCountdown();
  </script>
</body>
</html>
