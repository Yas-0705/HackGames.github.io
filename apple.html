<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Apple — Predictor</title>
  <meta name="theme-color" content="#0b0f1c" />
  <style>
    :root{
      --bg:#0b0f1c; --panel:#0f1732; --text:#e6eaf5; --muted:#9fb0c9;
      --accent:#f97316; --good:#10b981;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; background:linear-gradient(180deg, #0b0f1c 0%, #0a1226 100%);
      color:var(--text); font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Inter,Roboto,Arial,sans-serif;
    }
    .wrap{ min-height:100svh; max-width:520px; margin:0 auto; padding:16px 12px 24px; display:flex; flex-direction:column; gap:12px }
    .top{ display:flex; align-items:center; gap:10px }
    .back{
      width:40px; height:40px; border-radius:12px; border:1px solid rgba(255,255,255,.08);
      background:linear-gradient(145deg,#141f3f,#0f1732); color:#cbd5e1; display:grid; place-items:center; cursor:pointer;
    }
    .title{ font-weight:900; letter-spacing:.4px; font-size:18px }

    .panel{
      background:linear-gradient(180deg, rgba(16,23,49,.92), rgba(11,16,32,.9));
      border:1px solid rgba(255,255,255,.06); border-radius:16px; padding:14px; position:relative; overflow:hidden;
    }

    /* Plateau 5 colonnes x 10 lignes */
    .board{
      display:grid; grid-template-columns:repeat(5, 1fr); gap:6px; margin-top:6px;
    }

    /* Tuile bois par défaut */
    .tile{
      aspect-ratio: 1 / .6; /* rectangulaire façon planche */
      border-radius:10px; border:1px solid rgba(0,0,0,.25);
      background:
        linear-gradient(180deg, #c88c4a, #b87733 60%, #a9632a),
        repeating-linear-gradient(90deg, rgba(0,0,0,.08) 0 1px, transparent 1px 6px),
        radial-gradient(60% 80% at 70% 40%, rgba(255,255,255,.18), transparent 60%);
      box-shadow: inset 0 2px 0 rgba(255,255,255,.2), inset 0 -2px 0 rgba(0,0,0,.2), 0 4px 10px rgba(0,0,0,.25);
      position:relative; overflow:hidden; display:grid; place-items:center;
      transition:transform .12s ease, filter .2s ease, box-shadow .2s ease, background .2s ease, border-color .2s ease;
    }
    .tile:hover{ transform:translateY(-2px) }

    /* Sélection = gazon + effet */
    .tile.selected{
      border-color:rgba(0,0,0,.22);
      background:
        radial-gradient(50% 50% at 20% 30%, rgba(255,255,255,.15), transparent 60%),
        repeating-linear-gradient(45deg, rgba(0,0,0,.05) 0 1px, transparent 1px 6px),
        linear-gradient(180deg, #3cc15a, #239a43 60%, #1e7e37);
      box-shadow: 0 6px 16px rgba(0,0,0,.25), inset 0 0 40px rgba(16,185,129,.12);
      filter:saturate(1.05);
    }

    /* Pomme rouge (SVG inline) */
    .apple{
      width:58%; max-width:84px; aspect-ratio:1/1; display:block; animation:pop .22s ease;
      filter: drop-shadow(0 6px 12px rgba(0,0,0,.25));
    }
    .apple svg{ width:100%; height:100%; display:block }
    @keyframes pop{ from{ transform:scale(.4); opacity:.3 } to{ transform:scale(1); opacity:1 } }

    /* Halo/pulse doux autour de la pomme */
    .pulse{
      position:absolute; inset:-20%; border-radius:16px;
      background:radial-gradient(40% 40% at 50% 50%, rgba(16,185,129,.22), transparent 70%);
      animation:ping 1.2s ease-out infinite; pointer-events:none;
    }
    @keyframes ping{ from{ transform:scale(.7); opacity:.7 } to{ transform:scale(1.3); opacity:0 } }

    .controls{ display:flex; align-items:center; justify-content:space-between; gap:10px; margin-top:12px }
    .run{
      flex:1; height:44px; border:none; border-radius:12px;
      background:linear-gradient(135deg, #f97316, #f59e0b); color:#0b0f1c;
      font-weight:900; letter-spacing:.2px; box-shadow:0 12px 26px rgba(249,115,22,.35); cursor:pointer;
      transition:transform .12s ease, opacity .15s ease;
    }
    .run:active{ transform:translateY(1px) scale(.98) }
    .meta{ min-width:152px; text-align:right; color:#9fb0c9; font-size:12px }
    .legend{ margin-top:8px; color:#9fb0c9; font-size:12px; text-align:center }

    footer{ margin-top:auto; color:#8ea3c5; font-size:12px; text-align:center; opacity:.7 }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="top">
      <button class="back" onclick="location.href='index.html'">←</button>
      <div class="title" id="gameTitle">Apple — Chemin</div>
    </div>

    <section class="panel">
      <div class="board" id="board"></div>

      <div class="controls">
        <button class="run" id="run">Générer le chemin</button>
        <div class="meta"><span id="metaLabel">Prêt</span> <b id="count">--:--</b></div>
      </div>

      <div class="legend">Pause obligatoire après chaque génération.</div>
    </section>

    <!-- <footer>© 2025 Predictor — Site public non affilié. +18.</footer> -->
  </div>

  <script>
    const ROWS = 10, COLS = 5;
    // Cooldown (pause) après génération
    const COOL_MIN = 30, COOL_MAX = 60; // secondes
    let lockUntil = 0, timer = null;

    const qs = new URLSearchParams(location.search);
    const game = qs.get('game') || 'Apple';
    document.getElementById('gameTitle').textContent = game + ' — Chemin';

    const boardEl = document.getElementById('board');
    const runBtn = document.getElementById('run');
    const countEl = document.getElementById('count');
    const labelEl = document.getElementById('metaLabel');

    // Construire la grille 5 x 10
    const grid = [];
    for(let r=0;r<ROWS;r++){
      grid[r]=[];
      for(let c=0;c<COLS;c++){
        const t = document.createElement('div');
        t.className='tile';
        t.addEventListener('click',()=>{ t.style.transform='scale(.98)'; setTimeout(()=>t.style.transform='',100); });
        boardEl.appendChild(t); grid[r][c]=t;
      }
    }

    function appleSVG(){
      return `
      <svg viewBox="0 0 200 200" xmlns="http://www.w3.org/2000/svg">
        <defs>
          <radialGradient id="glow" cx="35%" cy="30%" r="60%">
            <stop offset="0%" stop-color="rgba(255,255,255,0.75)"/>
            <stop offset="60%" stop-color="rgba(255,255,255,0)"/>
          </radialGradient>
        </defs>
        <!-- tige -->
        <path d="M105 55 C110 35, 125 28, 135 26" stroke="#6b4f3a" stroke-width="10" stroke-linecap="round" fill="none"/>
        <!-- feuille -->
        <path d="M125 35 C160 30, 165 70, 130 75 C110 72, 105 45, 125 35 Z" fill="#22c55e"/>
        <!-- corps de la pomme -->
        <path d="M100 40 C 140 40, 170 70, 170 110 C 170 150, 140 180, 100 180 C 60 180, 30 150, 30 110 C 30 70, 60 40, 100 40 Z" fill="#e11d48"/>
        <!-- reflet -->
        <circle cx="80" cy="80" r="32" fill="url(#glow)"/>
      </svg>`;
    }

    function clearBoard(){
      grid.flat().forEach(t=>{
        t.classList.remove('selected');
        t.querySelectorAll('.apple,.pulse').forEach(n=>n.remove());
      });
    }

    function mark(r,c){
      const t = grid[r][c];
      t.classList.add('selected');

      const apple = document.createElement('div');
      apple.className = 'apple';
      apple.innerHTML = appleSVG();
      t.appendChild(apple);

      const pl = document.createElement('div');
      pl.className = 'pulse';
      t.appendChild(pl);
    }

    function pad(n){ return String(n).padStart(2,'0'); }
    function format(sec){ sec=Math.max(0,sec|0); return pad(Math.floor(sec/60))+':'+pad(sec%60); }

    function startCooldown(){
      const extra = (COOL_MIN + Math.floor(Math.random()*(COOL_MAX-COOL_MIN+1))) * 1000;
      lockUntil = Date.now() + extra;
      tick();
    }

    function tick(){
      const now = Date.now();
      if(now < lockUntil){
        labelEl.textContent = 'Pause';
        countEl.textContent = format(Math.ceil((lockUntil-now)/1000));
        runBtn.disabled = true; runBtn.style.opacity = .6;
      }else{
        labelEl.textContent = 'Prêt';
        countEl.textContent = '--:--';
        runBtn.disabled = false; runBtn.style.opacity = 1;
      }
    }
    timer = setInterval(tick,1000); tick();

    runBtn.addEventListener('click', ()=>{
      if(runBtn.disabled) return;
      clearBoard();

      // Profondeur entre 2 et 5 étages, de BAS vers HAUT
      const depth = 2 + Math.floor(Math.random()*4); // 2..5
      for(let step=0; step<depth; step++){
        const r = ROWS - 1 - step;              // 9, 8, 7, ...
        const c = Math.floor(Math.random()*COLS); // 0..4
        mark(r,c);
      }
      startCooldown();
    });
  </script>
</body>
</html>
